# Experimental CSR test
# Generated by scripts/gen_csr_test.py (part of riscv-dv)
# Manual edits to fit with BSP and enhance debug
.include "user_define.h"
.section .text.start
.globl _start
.section .text
#.include "user_init.s"
.type _start, @function

_start:
    j _start_main

.globl _start_main
.section .text
_start_main:
    # misa
one:
    addi x28,zero,'1'
    li x14, 0xa5a5a5a5
    csrrw x15, 769, x14
#    li x14, 0x40000104
    li x14, 0x40801104
#    bne x14, x15, csr_fail
    beq x14, x15, two
    j csr_fail
two:
    addi x28,zero,'2'
    li x14, 0x5a5a5a5a
    csrrw x15, 769, x14
    li x14, 0x81a5a5a5
#    bne x14, x15, csr_fail
    beq x14, x15, three
    j csr_fail
three:
    addi x28,zero,'3'
    li x14, 0x919598d6
    csrrw x15, 769, x14
    li x14, 0x425a5a5a
    bne x14, x15, csr_fail
    li x14, 0xa5a5a5a5
    csrrs x15, 769, x14
    li x14, 0x819598d6
    bne x14, x15, csr_fail
    li x14, 0x5a5a5a5a
    csrrs x15, 769, x14
    li x14, 0x81b5bdf7
    bne x14, x15, csr_fail
    li x14, 0xe3a61f37
    csrrs x15, 769, x14
    li x14, 0xc3ffffff
    bne x14, x15, csr_fail
    li x14, 0xa5a5a5a5
    csrrc x15, 769, x14
    li x14, 0xc3ffffff
    bne x14, x15, csr_fail
    li x14, 0x5a5a5a5a
    csrrc x15, 769, x14
    li x14, 0x425a5a5a
    bne x14, x15, csr_fail
    li x14, 0x3bcb0de4
    csrrc x15, 769, x14
    li x14, 0x00000000
    bne x14, x15, csr_fail
    csrrwi x15, 769, 0b00101
    li x14, 0x00000000
    bne x14, x15, csr_fail
    csrrwi x15, 769, 0b11010
    li x14, 0x00000005
    bne x14, x15, csr_fail
    csrrwi x15, 769, 0b01000
    li x14, 0x0000001a
    bne x14, x15, csr_fail
    csrrsi x15, 769, 0b00101
    li x14, 0x00000008
    bne x14, x15, csr_fail
    csrrsi x15, 769, 0b11010
    li x14, 0x0000000d
    bne x14, x15, csr_fail
    csrrsi x15, 769, 0b11111
    li x14, 0x0000001f
    bne x14, x15, csr_fail
    csrrci x15, 769, 0b00101
    li x14, 0x0000001f
    bne x14, x15, csr_fail
    csrrci x15, 769, 0b11010
    li x14, 0x0000001a
    bne x14, x15, csr_fail
    csrrci x15, 769, 0b10000
    li x14, 0x00000000
    bne x14, x15, csr_fail
    # mscratch
    li x14, 0xa5a5a5a5
    csrrw x15, 832, x14
    li x14, 0x00000000
    bne x14, x15, csr_fail
    li x14, 0x5a5a5a5a
    csrrw x15, 832, x14
    li x14, 0xa5a5a5a5
    bne x14, x15, csr_fail
    li x14, 0xfcb4d473
    csrrw x15, 832, x14
    li x14, 0x5a5a5a5a
    bne x14, x15, csr_fail
    li x14, 0xa5a5a5a5
    csrrs x15, 832, x14
    li x14, 0xfcb4d473
    bne x14, x15, csr_fail
    li x14, 0x5a5a5a5a
    csrrs x15, 832, x14
    li x14, 0xfdb5f5f7
    bne x14, x15, csr_fail
    li x14, 0x52244653
    csrrs x15, 832, x14
    li x14, 0xffffffff
    bne x14, x15, csr_fail
    li x14, 0xa5a5a5a5
    csrrc x15, 832, x14
    li x14, 0xffffffff
    bne x14, x15, csr_fail
    li x14, 0x5a5a5a5a
    csrrc x15, 832, x14
    li x14, 0x5a5a5a5a
    bne x14, x15, csr_fail
    li x14, 0x8d47eac9
    csrrc x15, 832, x14
    li x14, 0x00000000
    bne x14, x15, csr_fail
    csrrwi x15, 832, 0b00101
    li x14, 0x00000000
    bne x14, x15, csr_fail
    csrrwi x15, 832, 0b11010
    li x14, 0x00000005
    bne x14, x15, csr_fail
    csrrwi x15, 832, 0b10111
    li x14, 0x0000001a
    bne x14, x15, csr_fail
    csrrsi x15, 832, 0b00101
    li x14, 0x00000017
    bne x14, x15, csr_fail
    csrrsi x15, 832, 0b11010
    li x14, 0x00000017
    bne x14, x15, csr_fail
    csrrsi x15, 832, 0b01110
    li x14, 0x0000001f
    bne x14, x15, csr_fail
    csrrci x15, 832, 0b00101
    li x14, 0x0000001f
    bne x14, x15, csr_fail
    csrrci x15, 832, 0b11010
    li x14, 0x0000001a
    bne x14, x15, csr_fail
    csrrci x15, 832, 0b01100
    li x14, 0x00000000
    bne x14, x15, csr_fail
    csrr x15, 832
    li x14, 0x00000000
    bne x14, x15, csr_fail
test_done:
    lui a0,print_port>>12
    addi a1,zero,'\n'
    sw a1,0(a0)
    addi a1,zero,'C'
    sw a1,0(a0)
    addi a1,zero,'V'
    sw a1,0(a0)
    addi a1,zero,'3'
    sw a1,0(a0)
    addi a1,zero,'2'
    sw a1,0(a0)
    addi a1,zero,' '
    sw a1,0(a0)
    addi a1,zero,'D'
    sw a1,0(a0)
    addi a1,zero,'O'
    sw a1,0(a0)
    addi a1,zero,'N'
    sw a1,0(a0)
    addi a1,zero,'E'
    sw a1,0(a0)
    addi a1,zero,'\n'
    sw a1,0(a0)
    sw a1,0(a0)
csr_pass:
    li x18, 123456789
    li x17, 0x20000000
    sw x18,0(x17)
    wfi
csr_fail:
    lui a0,print_port>>12
    addi a1,zero,'\n'
    sw a1,0(a0)
    sw x28,0(a0)
    sw a1,0(a0)
    sw a1,0(a0)
    li x18, 1
    li x17, 0x20000000
    sw x18,0(x17)
    wfi
